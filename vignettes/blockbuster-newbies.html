<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Matthew Gregory" />

<meta name="date" content="2017-05-17" />

<title>Blockbuster for R Newbies</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Blockbuster for R Newbies</h1>
<h4 class="author"><em>Matthew Gregory</em></h4>
<h4 class="date"><em>2017-05-17</em></h4>



<blockquote>
<p>I’m trying to free your mind, Neo. But I can only show you the door. You’re the one that has to walk through it. (<a href="http://www.imdb.com/title/tt0133093/quotes">via</a>)</p>
</blockquote>
<div id="a-beginners-guide-to-blockbuster" class="section level2">
<h2>A BeginneR’s Guide to blockbuster</h2>
<p>This vignette focuses on providing a user with all the skills necessary to provide the blockbuster function with the desired inputs, thus asking it the right question. This will produce an output of the class <code>blockbuster_list</code>. The user will be shown how to handle this object for basic business questions.</p>
<ul>
<li>What will the total cost of repairs be in the three blocks with <code>buildingid</code>’s 4382, 4472 and 4487 after five years?</li>
</ul>
<p>The <code>tidyverse</code> is a bunch of useful packages all rolled into one. We rely on it throughout this vignette as it provides a more beginner friendly approach to R. We load it now.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(tidyverse)  <span class="co">#  if not already loaded, load it</span></code></pre></div>
<pre><code>## Loading required package: tidyverse</code></pre>
<pre><code>## Loading tidyverse: ggplot2
## Loading tidyverse: tibble
## Loading tidyverse: tidyr
## Loading tidyverse: readr
## Loading tidyverse: purrr
## Loading tidyverse: dplyr</code></pre>
<pre><code>## Conflicts with tidy packages ----------------------------------------------</code></pre>
<pre><code>## filter(): dplyr, stats
## lag():    dplyr, stats</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(blockbuster)  <span class="co">#  we need this for obvious reasons</span></code></pre></div>
<div id="blockbuster-basics" class="section level3">
<h3>blockbuster basics</h3>
<p>How to get started? <code>blockbuster()</code> is the main function from the blockbuster package that we will use to carry out the deterioration, rebuild and repair of the school blocks of interest. We can inspect the help using a <code>?</code> prefix.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">? blockbuster</code></pre></div>
<p>Remember, our business question above? How do we solve this using this function? We can get the formal arugments of the function using the <code>formals</code> function. This tells us that there are default values for three of the five arguments but two need us to set the values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">formals</span>(blockbuster)</code></pre></div>
<pre><code>## $blockbuster_tibble
## 
## 
## $forecast_horizon
## 
## 
## $rebuild_monies
## [1] 0
## 
## $repair_monies
## [1] 0
## 
## $rebuild_cost_rate
## [1] 1274</code></pre>
<p>If we don’t provide these two arguments, what happens?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">blockbuster</span>(blockbuster_pds[<span class="dv">1</span>, ], )
<span class="kw">blockbuster</span>(, <span class="dv">1</span>)</code></pre></div>
<p>Given our question, the second argument <code>forecast_horizon</code> should be obvious. Using the help what format should this argument take?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">blockbuster</span>(, <span class="dt">forecast_horizon =</span> <span class="dv">1</span>)</code></pre></div>
<p>Now we need to provide the first argument which is the <code>blockbuster_tibble</code>. What form might this take? Look at the example in the help.</p>
</div>
<div id="blockbuster_pds-the-data" class="section level3">
<h3>blockbuster_pds, the data</h3>
<p>Our <code>blockbuster_tibble</code> can either be all of the <code>blockbuster_pds</code> or a subset thereof (how many rows and columns are there in this dataset?).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?blockbuster_pds</code></pre></div>
<p>Using R it’s important to expand your basic vocabulary. A useful function is <code>str</code>. What does it do and what does it reveal about the <code>blockbuster_pds</code> object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(blockbuster_pds)</code></pre></div>
<pre><code>## Classes 'tbl_df', 'tbl' and 'data.frame':    254878 obs. of  25 variables:
##  $ lano                 : int  331 331 331 331 331 331 331 331 331 331 ...
##  $ siteid               : int  1266 1266 1266 1266 1266 1266 1266 1266 1266 1266 ...
##  $ buildingid           : int  4382 4382 4382 4382 4382 4382 4382 4382 4382 4382 ...
##  $ elementid            : int  1700 1701 1706 1972 1719 1714 1716 1922 1924 1928 ...
##  $ element              : Factor w/ 12 levels &quot;Ceilings&quot;,&quot;Electrical Services&quot;,..: 11 11 11 11 11 11 11 5 5 5 ...
##  $ sub_element          : Factor w/ 47 levels &quot;Alarms&quot;,&quot;Boundary walls and fences&quot;,..: 36 36 5 5 7 7 7 41 40 26 ...
##  $ const_type           : Factor w/ 95 levels &quot;Air conditioning&quot;,..: 30 67 24 66 62 29 55 32 32 32 ...
##  $ const_type_accessible: Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 2 2 2 2 2 2 2 2 ...
##  $ grade                : Factor w/ 6 levels &quot;N&quot;,&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,..: 2 2 3 3 2 4 2 3 3 2 ...
##  $ cost                 : num  0 0 3910 10335 0 ...
##  $ composition          : num  0.3 0.7 0.3 0.7 0.35 0.3 0.35 0.05 0.6 0.05 ...
##  $ storeys              : num  3 3 3 3 3 3 3 3 3 3 ...
##  $ gifa                 : num  1916 1916 1916 1916 1916 ...
##  $ ground_gifa          : num  1028 1028 1028 1028 1028 ...
##  $ block_perimeter      : num  167 167 167 167 167 167 167 167 167 167 ...
##  $ height               : num  8 8 8 8 8 8 8 8 8 8 ...
##  $ windows_doors        : num  10 10 10 10 10 10 10 10 10 10 ...
##  $ number_lifts         : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ site_area_exc_field  : num  2100 2100 2100 2100 2100 2100 2100 2100 2100 2100 ...
##  $ boundary_length      : num  250 250 250 250 250 250 250 250 250 250 ...
##  $ field_area           : num  1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 ...
##  $ swimming_pool        : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ timestep             : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ unit_area            : num  308 720 308 720 360 ...
##  $ cost_sum             : num  133987 133987 133987 133987 133987 ...</code></pre>
<p>Using the above or any other functions;<br />
* What is the class of the <code>blockbuster_pds</code> object?<br />
* What do you think each variable means? (use <code>?blockbuster_pds</code> if you get stuck)<br />
* What does each row represent?</p>
</div>
<div id="filtering-the-data-to-answer-the-question" class="section level3">
<h3>filtering the data to answer the question</h3>
<p>Given our findings above we can run a simple simulation using <code>blockbuster</code>. Be careful in how you subset as simulating all the rows takes a long time! What have I done below?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">one_yr_later_a &lt;-<span class="st"> </span><span class="kw">blockbuster</span>(<span class="dt">blockbuster_tibble =</span> blockbuster_pds[<span class="dv">1</span>, ],
                            <span class="dt">forecast_horizon =</span> <span class="dv">1</span>)

one_yr_later_b &lt;-<span class="st"> </span><span class="kw">blockbuster</span>(<span class="dt">blockbuster_tibble =</span> blockbuster_pds[<span class="dv">1</span>:<span class="dv">2</span>, ],
                            <span class="dt">forecast_horizon =</span> <span class="dv">1</span>)

one_yr_later_c &lt;-<span class="st"> </span><span class="kw">blockbuster</span>(<span class="dt">blockbuster_tibble =</span> blockbuster_pds[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">7</span>), ],
                            <span class="dt">forecast_horizon =</span> <span class="dv">1</span>)</code></pre></div>
<p><a href="http://adv-r.had.co.nz/Subsetting.html">Standard subsetting</a> has its place but the <a href="https://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html">dplyr</a> package provides a readily interpretable and beginner friendly system of verbs to manipulate dataframes. We use it here to <code>filter</code> for rows associated with our <code>buildingid</code> of interest.</p>
<p>Using the dplyr vignette, <code>filter</code> the <code>blockbuster_pds</code> dataframe object (I call it a <code>blockbuster_tibble</code>, as it’s a tibble with the variables necessary for use in the blockbuster function) for the correct blocks. What do you think the pipe (<code>|</code>) operator does? Using the dplyr help how might I filter for just these blocks’ roofs?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dplyr::<span class="kw">filter</span>(blockbuster::blockbuster_pds,  (buildingid ==<span class="st"> </span><span class="dv">4382</span> |
<span class="st">                </span>buildingid ==<span class="st"> </span><span class="dv">4472</span> |
<span class="st">                </span>buildingid ==<span class="st"> </span><span class="dv">4487</span>) <span class="co">#  &amp; element == &quot;Roofs&quot;</span>
              )</code></pre></div>
<pre><code>## # A tibble: 135 × 25
##     lano siteid buildingid elementid                      element
##    &lt;int&gt;  &lt;int&gt;      &lt;int&gt;     &lt;int&gt;                       &lt;fctr&gt;
## 1    331   1266       4382      1700                        Roofs
## 2    331   1266       4382      1701                        Roofs
## 3    331   1266       4382      1706                        Roofs
## 4    331   1266       4382      1972                        Roofs
## 5    331   1266       4382      1719                        Roofs
## 6    331   1266       4382      1714                        Roofs
## 7    331   1266       4382      1716                        Roofs
## 8    331   1266       4382      1922 Fixed Furniture and Fittings
## 9    331   1266       4382      1924 Fixed Furniture and Fittings
## 10   331   1266       4382      1928 Fixed Furniture and Fittings
## # ... with 125 more rows, and 20 more variables: sub_element &lt;fctr&gt;,
## #   const_type &lt;fctr&gt;, const_type_accessible &lt;fctr&gt;, grade &lt;fctr&gt;,
## #   cost &lt;dbl&gt;, composition &lt;dbl&gt;, storeys &lt;dbl&gt;, gifa &lt;dbl&gt;,
## #   ground_gifa &lt;dbl&gt;, block_perimeter &lt;dbl&gt;, height &lt;dbl&gt;,
## #   windows_doors &lt;dbl&gt;, number_lifts &lt;dbl&gt;, site_area_exc_field &lt;dbl&gt;,
## #   boundary_length &lt;dbl&gt;, field_area &lt;dbl&gt;, swimming_pool &lt;fctr&gt;,
## #   timestep &lt;int&gt;, unit_area &lt;dbl&gt;, cost_sum &lt;dbl&gt;</code></pre>
<div id="practice" class="section level4">
<h4>Practice</h4>
<ul>
<li>What if I wanted to filter for blocks that were in the Camden Local Authority of interest, how might I do that? (you need to Google)<br />
</li>
<li>Filter for all the blocks in Camden except <code>buildingid</code> 124480? (not equal to 124480)</li>
<li>How would I filter for school blocks from a particular building era? (e.g. pre-1976)<br />
</li>
<li>How would I filter for just critical building components such as Roofs and Walls?</li>
</ul>
</div>
<div id="caveat" class="section level4">
<h4>Caveat</h4>
<p>Remember <code>blockbuster_pds</code> represents a ten percent sample of the entire Property Data Survey. Details of the SQL query used to produce the sample are found within the package at <code>blockbuster/inst/sql/blockbuster_ten_pc_sample.sql</code>.</p>
</div>
</div>
<div id="running-a-simulation" class="section level3">
<h3>Running a simulation</h3>
<p>Now we are familiar with subsetting the <code>blockbuster_pds</code> dataframe we can go back to answering the original business question.</p>
<ul>
<li>What will the total cost of repairs be in the three blocks with <code>buildingid</code>’s 4382, 4472 and 4487 after five years?</li>
</ul>
<p>It’s good practice to manipulate your data and then check it looks rights. Here we assign it to object <code>x</code>. Assigning stuff is useful as it saves time if you are likely to use the object again (particularly true for objects that take a long time to create).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co">#  We filter our PDS sample for just three blocks to keep things simple           </span>
  x &lt;-<span class="st"> </span>dplyr::<span class="kw">filter</span>(blockbuster::blockbuster_pds,
                     buildingid ==<span class="st"> </span><span class="dv">4382</span> |
<span class="st">                       </span>buildingid ==<span class="st"> </span><span class="dv">4472</span> |<span class="st"> </span>buildingid ==<span class="st"> </span><span class="dv">4487</span>)         </code></pre></div>
<p>Now we can run our simulation using <code>x</code> as our <code>blockbuster_tibble</code> argument and <code>5</code> for our <code>forecast_horizon</code> argument for the <code>blockbuster</code> function. Note that the arguments don’t need to be named if they are in the correct order as shown using <code>formals</code> earlier. See Hadley’s chapter on <a href="http://adv-r.had.co.nz/Functions.html">functions</a> for more detail.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="kw">blockbuster</span>(<span class="dt">blockbuster_tibble =</span> x, <span class="dt">forecast_horizon =</span> <span class="dv">5</span>)
<span class="co">#  z &lt;- blockbuster(x, 5) </span>
<span class="co">#  identical(y, z)  #  TRUE</span>
<span class="kw">class</span>(y)</code></pre></div>
<pre><code>## [1] &quot;blockbuster_list&quot; &quot;list&quot;</code></pre>
</div>
<div id="using-generic-methods-on-output" class="section level3">
<h3>Using generic methods on output</h3>
<p>The <code>blockbuster</code> functions produces a custom output object of class “blockbuster_list” (deriviative to “list”). This informs the generic methods (for which I have coded a method) to handle this object in a certain way. This helps users to quickly visualise and summarise the output without needing much coding expertise.</p>
<p>The underlying code and details can be found in the other vignette. You can just copy and paste from there replacing the output with your blockbuster ouput of interest.</p>
<div id="line-plot" class="section level4">
<h4>Line plot</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(y)</code></pre></div>
</div>
<div id="boxplot" class="section level4">
<h4>Boxplot</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(y)</code></pre></div>
</div>
<div id="summary" class="section level4">
<h4>Summary</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(y)</code></pre></div>
</div>
</div>
<div id="handling-a-list" class="section level3">
<h3>Handling a list</h3>
<p>The <code>blockbuster</code> function produces a list of dataframes with <code>timestep == 0</code> at index 1 and the last year in the simulation at index <code>forecast_horizon + 1</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#  y[[1]]  #  timestep 0</span>

final_year &lt;-<span class="st"> </span>y[[<span class="dv">6</span>]]
final_year</code></pre></div>
<pre><code>## # A tibble: 646 × 27
##     lano siteid buildingid elementid  element sub_element
##    &lt;int&gt;  &lt;int&gt;      &lt;int&gt;     &lt;int&gt;   &lt;fctr&gt;      &lt;fctr&gt;
## 1    831   1301       4472      1810 Ceilings   Generally
## 2    831   1301       4472      1810 Ceilings   Generally
## 3    831   1301       4472      1810 Ceilings   Generally
## 4    831   1301       4472      1810 Ceilings   Generally
## 5    831   1301       4472      1810 Ceilings   Generally
## 6    831   1301       4472      1809 Ceilings   Generally
## 7    831   1301       4472      1809 Ceilings   Generally
## 8    831   1301       4472      1809 Ceilings   Generally
## 9    831   1301       4472      1809 Ceilings   Generally
## 10   831   1301       4472      1813 Ceilings   Generally
## # ... with 636 more rows, and 21 more variables: const_type &lt;fctr&gt;,
## #   const_type_accessible &lt;fctr&gt;, grade &lt;fctr&gt;, cost &lt;dbl&gt;,
## #   composition &lt;dbl&gt;, storeys &lt;dbl&gt;, gifa &lt;dbl&gt;, ground_gifa &lt;dbl&gt;,
## #   block_perimeter &lt;dbl&gt;, height &lt;dbl&gt;, windows_doors &lt;dbl&gt;,
## #   number_lifts &lt;dbl&gt;, site_area_exc_field &lt;dbl&gt;, boundary_length &lt;dbl&gt;,
## #   field_area &lt;dbl&gt;, swimming_pool &lt;fctr&gt;, timestep &lt;dbl&gt;,
## #   cost_sum &lt;dbl&gt;, concated &lt;chr&gt;, block_rebuild_cost &lt;dbl&gt;,
## #   unit_area &lt;dbl&gt;</code></pre>
<p>You can manipulate the dataframes within the list as you please. For example, calculating Tukey’s five number summary of <code>cost</code> for the <code>final_year</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fivenum</span>(final_year$cost)</code></pre></div>
<pre><code>## [1]     0.00000     0.00000    26.65056   262.93612 74725.41325</code></pre>
<div id="practice-1" class="section level4">
<h4>Practice</h4>
<ul>
<li>What was the average cost at each timestep of the simulation?<br />
</li>
<li>Describe the trend using data.<br />
</li>
<li>Which block had the most expensive building component in the final year?<br />
</li>
<li>Was that tedious? (there’s a better way…)</li>
</ul>
<p>The dataframes are stored in a list for code efficiency and also because the dataframes after timestep zero have additional variables preventing straightforward binding. This isn’t a problem for an experienced R user. For more sophisticated methods to handle a list of dataframes see the <code>blockbuster_vignette</code>.</p>
</div>
</div>
<div id="additional-inputs" class="section level3">
<h3>Additional inputs</h3>
<p>Thus far we have simulated just the counterfactual. This package is interested in comparing different spending profiles on the rebuilding and repairing of the School Estate and its impact on those school buildings condition.</p>
<p>Use <code>?blockbuster</code> and the <code>formals</code> function to remind yourself of the other arguments we can provide the <code>blockbuster</code> function with.</p>
<p>Notice how the help says the other arguments must be “a numeric vector of length equal to the forecast_horizon or one.” What does this mean? What are the default values (the default is adopted if left blank)?</p>
<div id="more-than-one-way-to-skin-a-cat" class="section level4">
<h4>More than one way to skin a cat</h4>
<p>If you provide an input of length one then it is converted into a <a href="http://adv-r.had.co.nz/Data-structures.html#vectors">vector</a> using <code>rep(input, forecast_horizon)</code> (type <code>?rep()</code>). Alternatively you can provide a vector of length equal to the <code>forecast_horizon</code> using any of the <a href="https://cran.r-project.org/doc/manuals/r-devel/R-intro.html#Vectors-and-assignment">standard methods</a> that a Google search will reveal.</p>
<p>Here we demonstrate three different ways to provide the other arguments to <code>blockbuster</code>. The following code errors, use the error information to fix the input and re-run it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">z &lt;-<span class="st"> </span><span class="kw">blockbuster</span>(<span class="dt">blockbuster_tibble =</span> x, <span class="dt">forecast_horizon =</span> <span class="dv">5</span>,
            <span class="dt">rebuild_monies =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">9e4</span>, <span class="dv">0</span>, <span class="dv">0</span>),
            <span class="dt">repair_monies =</span> <span class="fl">5e3</span>,
            <span class="dt">rebuild_cost_rate =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">1280</span>, <span class="dv">4</span>), <span class="dv">1285</span>))</code></pre></div>
</div>
<div id="saving-for-later" class="section level4">
<h4>Saving for later</h4>
<p>We can save our <code>blockbuster_list</code> object using <code>saveRDS</code> and if we want to look at the data in the future we can load it into R using <code>readRDS</code> (described <a href="http://stackoverflow.com/questions/19967478/how-to-save-data-file-into-rdata">here</a>). But does this save all the arguments we used to create the <code>blockbuster_list</code>?</p>
<p>Try using the <code>attributes()</code> function to find out the inputs for <code>z</code>. How would you find out what the <code>forecast_horizon</code> was?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">attributes</span>(z)</code></pre></div>
</div>
<div id="practice-2" class="section level4">
<h4>Practice</h4>
<p>Upon fixing:</p>
<ul>
<li>Use the generic methods to describe what happens to the blocks.</li>
<li>Do you think rebuilding in the 2nd year was sensible? What happens if you rebuild in the last year? Does that reduce the total cost of repairs?</li>
<li>How many thousands of pounds are spent on the repair of each block per year?<br />
</li>
<li>Are you sure? Use <code>?repair</code> to check your assumption.</li>
<li>What is the rebuild_cost_rate in the final year?</li>
<li>What is it in the third year?<br />
</li>
<li>How would you extract the dataframe from z that contains <code>grade == N</code> building components for the first time?</li>
</ul>
</div>
</div>
<div id="case-study" class="section level3">
<h3>Case study</h3>
<p>Made-up numbers and purely hypothetical.</p>
<p>Doncaster (LA code 371) are interested in improving their spending on rebuilding and repairs on their schools over the next three year period (imagine question was posed as data was collected). They are particularly interested in keeping all building components associated with their roofs in good working condition.</p>
<p>Currently they don’t rebuild and just spend £1,000,000 a year on reparations. They want to know if they would be better off with a different spending profile to reduce the overall cost by using that money to rebuild some of the worst off schools. As part of the projections they also want to know the total roof repairs costs for different approaches. You must also consider how construction inflation will affect the <code>rebuild_cost_rate</code> which is predicted to rise one percent each year.</p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
